dist: bionic
install:
- # Install DFINITY SDK.
- travis_retry wget https://sdk.dfinity.org/install.sh
- yes Y | sh install.sh
- # Install Nginx with Lua support.
- travis_retry sudo apt-get install --yes nginx libnginx-mod-http-lua
- sudo usermod -G adm -a $USER
- # Install Lua package manager.
- travis_retry sudo apt-get install --yes luarocks
- # Install Lua CBOR package.
- travis_retry sudo luarocks install org.conman.cbor
- # Install Lua Hex package.
- travis_retry sudo luarocks install hex
- # Install Lua OpenSSL package.
- travis_retry sudo apt-get install --yes libssl-dev
- travis_retry sudo luarocks install luaossl
- # Install Lua Socket package.
- travis_retry sudo luarocks install luasocket
script:
- # Compile WebAssembly module.
- dfx build
- # Start DFINITY server.
- nohup dfx start &
- sleep 5
- # Deploy WebAssembly module.
- dfx canister install --all connect
- # Update Lua script.
- id=$(xxd -p -u build/connect/_canister.id  | sed -e "s/.*/ibase=16; \0/" | bc)
- sed -e "s/^local CANISTER = '\(.*\)'/local CANISTER = '$id'/g" -i nginx/index.lua
- # Start Nginx server.
- sudo sg adm -c "nohup nginx -c nginx.conf -p nginx &"
- # Render index page.
- wget 127.0.0.1:8000
- cat index.html
